<!--

  Title: Node-Red-Contrib-OADR2-VEN
  Author: Bryan Nystrom
  Company: Argonne National Laborator

--!>

<style>
    .header {
        text-decoration: underline;
        font-weight: bold;
        margin-top: 5px;
    }
    .bordered {
        padding-left: 12px;
        padding-top: 4px;
        border: 1px solid lightgrey;
        box-sizing: border-box;
    }
</style>

<script type="text/javascript"> 
  RED.nodes.registerType('OpenADR-VTN', {
    category: 'config',
    defaults: {
      name: {value: "", required: false},
      tls: {type: 'tls-config', required: false},
      url: {
        value:"",
        validate:function(v) { 
          return (v.trim().length === 0) || (v.indexOf("://") === -1) || (v.trim().indexOf("http") === 0);
        },
        validate: true
      },
      authuser: {type: "text", required: false},
      authpw: {type: "password", required: false}
    },
    label: function() {
      return this.name || "VTN";
    },
    oneditprepare : function() {
      function updateTLSOptions() {
        if ($("#node-config-input-usetls").is(':checked')) {
          $("#node-row-tls").show();
        } else {
          $("#node-row-tls").hide();
        }
      }
      if (this.tls) {
        $('#node-config-input-usetls').prop('checked', true);
      } else {
        $('#node-config-input-usetls').prop('checked', false);
      }
      updateTLSOptions();
      $("#node-config-input-usetls").on("click",function() {
        updateTLSOptions();
      });

    },
    oneditsave: function() {
      if (!$("#node-config-input-usetls").is(':checked')) {
        $("#node-config-input-tls").val("_ADD_");
      }
    }
  });
</script>

<script type="text/x-red" data-template-name="OpenADR-VTN">
  <div class="form-row">
    <label for="node-config-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span>Name</label>
    <input type="text" id="node-config-input-name" data-i18n="[placeholder]common.label.name">
  </div>
  <div class="form-row">
    <label for="node-config-input-url"><i class="fa fa-globe"></i> <span data-i18n="httpin.label.url"></span>VTN URL</label>
    <input id="node-config-input-url" type="text" placeholder="http://vtn.ip.com:port">
  </div>

  <h3>Authentication</h3>
  <div class="form-row">
    <label for="node-config-input-authuser"><i class="fa fa-user"></i> Username</label>
    <input type="text" id="node-config-input-authuser" placeholder="optional">
  </div>
  <div class="form-row">
    <label for="node-config-input-authpw"><i class="fa fa-lock"></i> Password</label>
    <input type="password" id="node-config-input-authpw" placeholder="optional">
  </div>
                                                  
  <div class="form-row">
    <input type="checkbox" id="node-config-input-usetls" style="display: inline-block; width: auto; vertical-align: top;">
    <label for="node-config-input-usetls" style="width: auto" data-i18n="httpin.use-tls">Enable secure (SSL/TLS) connection</label>
    <div id="node-row-tls" class="hide">
      <label style="width: auto; margin-left: 20px; margin-right: 10px;" for="node-config-input-tls">
      <span data-i18n="httpin.tls-config"></span>
      </label><input type="text" style="width: 300px" id="node-config-input-tls">
    </div>
  </div>

  <div class="form-tips" id="tip-json" hidden><span data-i18n="httpin.tip.req"></span></div>

</script>

<script type="text/x-red" data-help-name="OpenADR-VTN">
  <p>Configures the target VTN</p>

  <h3>Configuration settings</h3>
    <dt>Name:</dt>
    <dd>The name of this VTN configuration</dd>

    <dt>VTN URL:</dt>
    <dd>The url of the VTN</dd>
    <dt>Username</dt>
    <dd>Optional username for basic authentication</dd>
    <dt>Password</dt>
    <dd>Optional password for basic authentication</dd>
    <dt>Enable secure (SSL/TLS) connection</dt>
    <dd>Configure secure connections to the VTN</dd>        
  <dl>
  </dl>

</script>


